## 1. Foundation Setup

- [x] 1.1 Install core dependencies: `npm install framer-motion recharts react-resizable-panels class-variance-authority clsx tailwind-merge`
- [x] 1.2 Initialize shadcn/ui: `npx shadcn@latest init` (select New York style, CSS variables)
- [x] 1.3 Add shadcn components: `npx shadcn@latest add select sheet card tooltip toggle separator sonner`
- [x] 1.4 Configure Cosmic palette in `globals.css` (Tailwind v4 uses CSS-first config)
- [x] 1.5 Update `globals.css` with CSS variables (--cosmic-gradient, --glass-bg, --glass-border)
- [x] 1.6 Create `lib/utils.ts` utility (auto-generated by shadcn with cn function)
- [x] 1.7 Create `components/ui/BackgroundEffect.tsx` for black hole gradient element

## 2. Database Schema Update

- [x] 2.1 Create migration SQL file `migration-favorites-rating.sql`
- [x] 2.2 Migration ready for Supabase SQL Editor:
  - Add `is_favorite BOOLEAN NOT NULL DEFAULT false`
  - Add `user_rating INTEGER CHECK (user_rating >= 1 AND user_rating <= 5)`
  - Create partial index `idx_watched_movies_favorite`
- [x] 2.3 Update `lib/types.ts`: Add `is_favorite: boolean` and `user_rating: number | null` to interfaces
- [x] 2.4 Update `lib/database.ts`:
  - Add `toggleFavorite(id: string): Promise<boolean>`
  - Add `updateRating(id: string, rating: number | null): Promise<void>`
  - Add `getFavorites(): Promise<WatchedMovie[]>`

## 3. Layout Components

- [x] 3.1 Create `components/ui/Header.tsx`:
  - Logo (left), filter/sort controls (right), auth button (right)
  - Glass-morphic styling with backdrop-blur
  - Mobile: hamburger menu with Sheet
- [x] 3.2 Create `components/ui/AnalyticsPanel.tsx`:
  - Wrapper using react-resizable-panels (Group, Panel, Separator)
  - Default 25%, min 15%, max 35%
  - localStorage persistence for width
  - Purple glow on resize handle hover
- [x] 3.3 Create `components/ui/MobileAnalyticsDrawer.tsx`:
  - FAB button (bottom-right) to open
  - Uses shadcn Sheet component
- [x] 3.4 Update `app/page.tsx` with new layout structure:
  - Remove tab navigation
  - Implement PanelGroup with analytics + main content
  - Add favorites section above grid

## 4. Filter/Sort Controls

- [x] 4.1 Create `hooks/useFilters.ts`:
  - Read/write URL search params
  - TypeScript types for filter state
  - applyFilters and getUniqueGenres utilities
- [x] 4.2 Create `components/ui/FilterControls.tsx` with all controls:
  - Sort dropdown (Recent, Title A-Z/Z-A, Rating, Release Date)
  - Media type filter (All, Movies, Series)
  - Genre filter (single-select dropdown)
  - Rating filter (min rating dropdown)
  - Clear filters button

## 5. Analytics Redesign

- [x] 5.1 Create `lib/analyticsUtils.ts`:
  - `aggregateByGenreAndMonth(movies)` function
  - `getTopGenres(data, limit=7)` function
  - `getQuickStats(movies)` function
  - Return Recharts-compatible data shape
- [x] 5.2 Create `components/GenreTrendChart.tsx`:
  - Recharts AreaChart with stacked areas
  - Violet/purple gradient fills
  - Custom tooltip with glass styling
- [x] 5.3 Add time range toggle (All Time / This Year) with localStorage persistence
- [x] 5.4 Implement loading state (shimmer skeleton)
- [x] 5.5 Implement empty state ("Start tracking movies to see trends")
- [x] 5.6 Quick stats cards (Movies, Series, Avg Rating)

## 6. Movie Card Redesign

- [x] 6.1 Create `components/MovieCard.tsx`:
  - Framer Motion hover animation (lift -8px, scale 1.02, shadow)
  - Poster image with fallback gradient
  - Overlay on hover: title, rating, media badge
- [x] 6.2 Add `components/StarRating.tsx`:
  - 5 Lucide Star icons (filled/outline)
  - Interactive for admin, read-only for visitors
  - Scale pulse animation on click
- [x] 6.3 Add favorite toggle button (heart icon) to card hover state
- [x] 6.4 Implement optimistic updates for rating and favorite toggle
- [x] 6.5 Add toast notifications via Sonner

## 7. Favorites Carousel

- [x] 7.1 Create `components/FavoritesCarousel.tsx`:
  - Horizontal scroll with CSS scroll-snap
  - Hero cards (240x360px desktop, responsive)
  - Glass-morphic card styling with purple glow border
- [x] 7.2 Implement empty state placeholder card
- [x] 7.3 Implement loading skeleton (3 cards with shimmer)
- [x] 7.4 Add scroll indicators (arrows) for desktop

## 8. Movie Grid Update

- [x] 8.1 Integrated MovieCard component directly in page.tsx grid
- [x] 8.2 Add Framer Motion stagger animation for grid items
- [x] 8.3 Grid uses responsive columns (2-6 based on viewport)
- [x] 8.4 Apply filter/sort from URL params to data via useFilters hook
- [x] 8.5 Add empty state for filtered results ("No movies match your filters")

## 9. Add Movie Modal Update

- [x] 9.1 Update `AddMovieModal.tsx` styling to match Cosmic theme
- [x] 9.2 Add optional 5-star rating input via StarRating component
- [x] 9.3 Add favorite toggle button with heart icon
- [x] 9.4 Style with glass-morphic background and Framer Motion animations

## 10. Motion & Page Load

- [x] 10.1 Motion integrated directly in components (no separate wrapper needed)
- [x] 10.2 Implemented animations:
  - Grid items stagger animation
  - Card hover lift and shadow
  - Favorites carousel stagger
  - Modal fade/scale animation
- [x] 10.3 Using useSyncExternalStore pattern for SSR-safe client detection
- [x] 10.4 Shimmer loading states in carousel and analytics

## 11. Responsive Implementation

- [x] 11.1 Grid columns configured for all breakpoints:
  - Mobile: 2 columns
  - Tablet: 3-4 columns
  - Desktop: 4-6 columns
- [x] 11.2 Mobile drawer for analytics (MobileAnalyticsDrawer + FAB)
- [x] 11.3 Mobile header with hamburger menu (Sheet)
- [x] 11.4 Favorites carousel responsive (scroll-snap, hidden on mobile drawer)
- [x] 11.5 Filter/sort in mobile menu via Header component

## 12. Cleanup & Validation

- [x] 12.1 Remove old Nivo packages: `npm uninstall @nivo/core @nivo/heatmap`
- [x] 12.2 Remove old files:
  - `components/AnalyticsDashboard.tsx`
  - `lib/heatmapUtils.ts`
- [x] 12.3 Run linting: `npm run lint` - PASSED (0 errors)
- [x] 12.4 Run type check: `npx tsc --noEmit` - PASSED
- [ ] 12.5 Test full flow (USER ACTION REQUIRED):
  - Run database migration in Supabase
  - Add movie with rating and favorite
  - View in grid and carousel
  - Filter and sort
  - Resize analytics panel
  - Mobile responsive behavior
- [ ] 12.6 Accessibility audit (USER ACTION REQUIRED):
  - Keyboard navigation for grid
  - Focus indicators (purple ring)
  - ARIA labels on interactive elements
- [ ] 12.7 Performance check (USER ACTION REQUIRED):
  - Lighthouse audit
  - Bundle size verification
  - 60fps animation verification

---

## Dependency Graph

```
Section 1 (Foundation) ──┬──> Section 3 (Layout) ──> Section 4 (Filters)
                         │                      ──> Section 5 (Analytics)
                         │                      ──> Section 6 (Card)
                         │                      ──> Section 7 (Carousel)
Section 2 (Database) ────┘

Section 4 + 5 + 6 + 7 ──> Section 8 (Grid Update)
Section 6 ──> Section 9 (Modal Update)
Section 8 ──> Section 10 (Motion)
Section 8 ──> Section 11 (Responsive)
All ──> Section 12 (Cleanup)
```

## Implementation Status

**COMPLETED**: All code implementation tasks (Sections 1-11, plus 12.1-12.4)

**USER ACTION REQUIRED**:
1. Run the database migration in Supabase SQL Editor (file: `migration-favorites-rating.sql`)
2. Test the full flow manually (task 12.5)
3. Conduct accessibility audit (task 12.6)
4. Run performance checks (task 12.7)
